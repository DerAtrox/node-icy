<!DOCTYPE HTML>
<html>
  <head>
    <title>&lt;audio&gt; Client for "Simple Proxy": node-radio-stream</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/prototype/1.6.1.0/prototype.js"></script>
    <script type="text/javascript">
      window.onload = function() {

        // This 'poll()' function polls for 'metadata' events from the radio stream
        function poll() {
          new Ajax.Request("/metadata", {
            onSuccess: function(r) {
              if (r.responseText) {
                $('events').innerHTML += r.responseText+"\n";
              }
            },
            onFailure: function(r) {
              console.error(r);
            },
            onComplete: function(r) {
              console.log("complete");
              poll();
            }
          })
        }
        poll();

        // We'll use 'canPlayType' to determine which file format to request
        var audio = $$("audio")[0];
        var src = "/stream.";
        if (audio.canPlayType('application/ogg; codecs="vorbis"') == "probably") {
          src += "ogg";
        } else {
          src += "mp3";
        }
        console.log("loading " + src);
        audio.src = src;
        audio.load();
        audio.play();
      }
    </script>
  </head>
  <body style="text-align:center;">
    <audio controls></audio>
    <br />
    <textarea id="events" style="width:500px;height:300px;">"metadata" events will be printed here...
</textarea>
  </body>
</html>
